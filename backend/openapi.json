{
  "openapi": "3.0.3",
  "info": {
    "title": "Portfolio Tracker API",
    "version": "1.1.0",
    "description": "Backend API for the Portfolio Tracker application (Node.js + Express + MySQL). Includes comprehensive audit logging, soft delete functionality, and user/holding status management."
  },
  "servers": [
    {
      "url": "https://www.bahar.co.il/fantasybroker-api",
      "description": "Production server"
    },
    {
      "url": "http://localhost:4000",
      "description": "Local development server"
    }
  ],
  "paths": {
    "/api/health": {
      "get": {
        "summary": "Health check",
        "description": "Returns basic health information to verify the API is running.",
        "tags": ["System"],
        "responses": {
          "200": {
            "description": "API is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "ok"
                    },
                    "db": {
                      "type": "string",
                      "example": "ok"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/google": {
      "post": {
        "summary": "Authenticate with Google",
        "description": "Accepts a Google ID token (credential) from the frontend, verifies it with Google, upserts the user in the database, and returns a backend JWT and user profile.",
        "tags": ["Auth"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "credential": {
                    "type": "string",
                    "description": "Google ID token (JWT) returned by Google Identity Services."
                  }
                },
                "required": ["credential"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                }
              }
            }
          },
          "400": {
            "description": "Missing or invalid request body",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Invalid or expired Google token",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/holdings": {
      "get": {
        "summary": "List holdings",
        "description": "Returns the current user's holdings.",
        "tags": ["Holdings"],
        "security": [
          { "BearerAuth": [] }
        ],
        "responses": {
          "200": {
            "description": "List of holdings for the current user.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "holdings": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": { "type": "integer", "format": "int64" },
                          "ticker": { "type": "string" },
                          "name": { "type": "string" },
                          "shares": { "type": "number" },
                          "purchasePrice": { "type": "number" },
                          "purchaseDate": { "type": "string", "format": "date" },
                          "sector": { "type": ["string", "null"] },
                          "assetClass": { "type": ["string", "null"] },
                          "createdAt": { "type": "string", "format": "date-time" },
                          "updatedAt": { "type": "string", "format": "date-time" }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Create holding",
        "description": "Creates a new holding for the current user.",
        "tags": ["Holdings"],
        "security": [
          { "BearerAuth": [] }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "ticker": { "type": "string" },
                  "name": { "type": "string" },
                  "shares": { "type": "number" },
                  "purchasePrice": { "type": "number" },
                  "purchaseDate": { "type": "string", "format": "date" },
                  "sector": { "type": "string" },
                  "assetClass": { "type": "string" }
                },
                "required": ["ticker", "name", "shares", "purchasePrice", "purchaseDate"]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Holding created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "holding": { "$ref": "#/components/schemas/Holding" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/holdings/{id}": {
      "put": {
        "summary": "Update holding",
        "description": "Updates an existing holding for the current user.",
        "tags": ["Holdings"],
        "security": [
          { "BearerAuth": [] }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer", "format": "int64" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "ticker": { "type": "string" },
                  "name": { "type": "string" },
                  "shares": { "type": "number" },
                  "purchasePrice": { "type": "number" },
                  "purchaseDate": { "type": "string", "format": "date" },
                  "sector": { "type": "string" },
                  "assetClass": { "type": "string" }
                },
                "required": ["ticker", "name", "shares", "purchasePrice", "purchaseDate"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Holding updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "holding": { "$ref": "#/components/schemas/Holding" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Holding not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Delete holding",
        "description": "Deletes an existing holding for the current user.",
        "tags": ["Holdings"],
        "security": [
          { "BearerAuth": [] }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer", "format": "int64" }
          }
        ],
        "responses": {
          "204": {
            "description": "Holding deleted"
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Holding not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/dividends": {
      "get": {
        "summary": "List dividends",
        "description": "Returns the current user's dividends.",
        "tags": ["Dividends"],
        "security": [
          { "BearerAuth": [] }
        ],
        "responses": {
          "200": {
            "description": "List of dividends for the current user.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "dividends": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": { "type": "integer", "format": "int64" },
                          "ticker": { "type": "string" },
                          "amount": { "type": "number" },
                          "shares": { "type": "number" },
                          "date": { "type": "string", "format": "date" },
                          "createdAt": { "type": "string", "format": "date-time" }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Create dividend",
        "description": "Creates a new dividend for the current user.",
        "tags": ["Dividends"],
        "security": [
          { "BearerAuth": [] }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "ticker": { "type": "string" },
                  "amount": { "type": "number" },
                  "shares": { "type": "number" },
                  "date": { "type": "string", "format": "date" }
                },
                "required": ["ticker", "amount", "shares", "date"]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Dividend created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "dividend": { "$ref": "#/components/schemas/Dividend" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/dividends/{id}": {
      "put": {
        "summary": "Update dividend",
        "description": "Updates an existing dividend for the current user.",
        "tags": ["Dividends"],
        "security": [
          { "BearerAuth": [] }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer", "format": "int64" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "ticker": { "type": "string" },
                  "amount": { "type": "number" },
                  "shares": { "type": "number" },
                  "date": { "type": "string", "format": "date" }
                },
                "required": ["ticker", "amount", "shares", "date"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Dividend updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "dividend": { "$ref": "#/components/schemas/Dividend" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Dividend not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Delete dividend",
        "description": "Deletes an existing dividend for the current user.",
        "tags": ["Dividends"],
        "security": [
          { "BearerAuth": [] }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer", "format": "int64" }
          }
        ],
        "responses": {
          "204": {
            "description": "Dividend deleted"
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Dividend not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/transactions": {
      "get": {
        "summary": "List transactions",
        "description": "Returns the current user's transactions.",
        "tags": ["Transactions"],
        "security": [
          { "BearerAuth": [] }
        ],
        "responses": {
          "200": {
            "description": "List of transactions for the current user.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "transactions": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": { "type": "integer", "format": "int64" },
                          "type": { "type": "string", "enum": ["buy", "sell", "dividend"] },
                          "ticker": { "type": "string" },
                          "shares": { "type": "number" },
                          "price": { "type": "number" },
                          "fees": { "type": "number" },
                          "date": { "type": "string", "format": "date" },
                          "createdAt": { "type": "string", "format": "date-time" }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Create transaction",
        "description": "Creates a new transaction for the current user.",
        "tags": ["Transactions"],
        "security": [
          { "BearerAuth": [] }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "type": { "type": "string", "enum": ["buy", "sell", "dividend"] },
                  "ticker": { "type": "string" },
                  "shares": { "type": "number" },
                  "price": { "type": "number" },
                  "fees": { "type": "number" },
                  "date": { "type": "string", "format": "date" }
                },
                "required": ["type", "ticker", "shares", "price", "date"]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Transaction created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "transaction": { "$ref": "#/components/schemas/Transaction" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/transactions/{id}": {
      "put": {
        "summary": "Update transaction",
        "description": "Updates an existing transaction for the current user.",
        "tags": ["Transactions"],
        "security": [
          { "BearerAuth": [] }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer", "format": "int64" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "type": { "type": "string", "enum": ["buy", "sell", "dividend"] },
                  "ticker": { "type": "string" },
                  "shares": { "type": "number" },
                  "price": { "type": "number" },
                  "fees": { "type": "number" },
                  "date": { "type": "string", "format": "date" }
                },
                "required": ["type", "ticker", "shares", "price", "date"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Transaction updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "transaction": { "$ref": "#/components/schemas/Transaction" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Transaction not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Delete transaction",
        "description": "Deletes an existing transaction for the current user.",
        "tags": ["Transactions"],
        "security": [
          { "BearerAuth": [] }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer", "format": "int64" }
          }
        ],
        "responses": {
          "204": {
            "description": "Transaction deleted"
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Transaction not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/portfolio/all": {
      "get": {
        "summary": "Get full portfolio",
        "description": "Returns holdings, dividends, and transactions for the current user.",
        "tags": ["Portfolio"],
        "security": [
          { "BearerAuth": [] }
        ],
        "responses": {
          "200": {
            "description": "Full portfolio for the current user.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "holdings": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/Holding" }
                    },
                    "dividends": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/Dividend" }
                    },
                    "transactions": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/Transaction" }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/market-data/{symbol}": {
      "get": {
        "summary": "Get market data for a stock symbol",
        "description": "Returns real-time market data for a single stock symbol from Finnhub API. Data is cached for 15 minutes to minimize API calls.",
        "tags": ["Market Data"],
        "parameters": [
          {
            "name": "symbol",
            "in": "path",
            "required": true,
            "description": "Stock ticker symbol (e.g., AAPL, GOOGL, TSLA)",
            "schema": {
              "type": "string",
              "example": "AAPL"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Market data for the requested symbol",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MarketData"
                }
              }
            }
          },
          "500": {
            "description": "Failed to fetch market data",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/market-data": {
      "get": {
        "summary": "Get market data for multiple stock symbols",
        "description": "Returns real-time market data for multiple stock symbols from Finnhub API. Maximum 50 symbols per request. Data is cached for 15 minutes.",
        "tags": ["Market Data"],
        "parameters": [
          {
            "name": "symbols",
            "in": "query",
            "required": true,
            "description": "Comma-separated list of stock ticker symbols (e.g., AAPL,GOOGL,TSLA)",
            "schema": {
              "type": "string",
              "example": "AAPL,GOOGL,TSLA"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Market data for the requested symbols",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/MarketData" }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request (missing symbols or too many symbols)",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Failed to fetch market data",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/admin/users": {
      "get": {
        "summary": "List all users (Admin only)",
        "description": "Returns a list of all users in the system. Requires admin privileges.",
        "tags": ["Admin"],
        "security": [
          { "BearerAuth": [] }
        ],
        "responses": {
          "200": {
            "description": "List of users",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "users": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": { "type": "integer" },
                          "email": { "type": "string" },
                          "name": { "type": "string" },
                          "authProvider": { "type": "string" },
                          "isDemo": { "type": "boolean" },
                          "isAdmin": { "type": "boolean" },
                          "status": { "type": "string" },
                          "createdAt": { "type": "string", "format": "date-time" },
                          "lastLogin": { "type": "string", "format": "date-time", "nullable": true }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Admin privileges required",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/admin/users/{id}/logs": {
      "get": {
        "summary": "Get user audit logs (Admin only)",
        "description": "Returns audit logs for a specific user. Requires admin privileges.",
        "tags": ["Admin"],
        "security": [
          { "BearerAuth": [] }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" },
            "description": "User ID"
          }
        ],
        "responses": {
          "200": {
            "description": "User audit logs",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": { "type": "integer" },
                        "email": { "type": "string" },
                        "name": { "type": "string" }
                      }
                    },
                    "logs": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/AuditLog"
                      }
                    },
                    "total": { "type": "integer" }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Admin privileges required",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "User not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/admin/users/{id}/admin": {
      "patch": {
        "summary": "Update user admin status (Admin only)",
        "description": "Grant or revoke admin privileges for a user. Requires admin privileges. Cannot remove your own admin status.",
        "tags": ["Admin"],
        "security": [
          { "BearerAuth": [] }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" },
            "description": "User ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "isAdmin": {
                    "type": "boolean",
                    "description": "Set to true to grant admin privileges, false to revoke"
                  }
                },
                "required": ["isAdmin"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Admin status updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "message": { "type": "string" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request - Invalid input",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Admin privileges required or cannot remove own admin status",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "User not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "example": 123
          },
          "email": {
            "type": "string",
            "format": "email",
            "example": "user@example.com"
          },
          "name": {
            "type": "string",
            "example": "Demo User"
          },
          "profilePicture": {
            "type": "string",
            "format": "uri",
            "nullable": true,
            "example": "https://example.com/avatar.png"
          },
          "authProvider": {
            "type": "string",
            "description": "Authentication provider used for this account.",
            "example": "google"
          },
          "isDemo": {
            "type": "boolean",
            "example": false
          },
          "isAdmin": {
            "type": "boolean",
            "description": "TRUE if user has admin privileges",
            "example": false
          },
          "status": {
            "type": "string",
            "enum": ["active", "inactive", "archived", "pending_verification", "invited", "suspended", "deleted"],
            "description": "User account status",
            "example": "active"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "Account creation timestamp",
            "example": "2025-01-15T10:30:00Z"
          },
          "lastLogin": {
            "type": "string",
            "format": "date-time",
            "nullable": true,
            "description": "Last login timestamp",
            "example": "2025-11-25T14:22:00Z"
          }
        },
        "required": ["id", "email", "authProvider", "isDemo"]
      },
      "AuthResponse": {
        "type": "object",
        "properties": {
          "user": {
            "$ref": "#/components/schemas/User"
          },
          "token": {
            "type": "string",
            "description": "Backend JWT used for authenticating subsequent API requests."
          }
        },
        "required": ["user", "token"]
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "example": "Invalid or expired Google token"
          }
        },
        "required": ["error"]
      },
      "Holding": {
        "type": "object",
        "properties": {
          "id": { "type": "integer", "format": "int64" },
          "ticker": { "type": "string" },
          "name": { "type": "string" },
          "shares": { "type": "number" },
          "purchasePrice": { "type": "number" },
          "purchaseDate": { "type": "string", "format": "date" },
          "sector": { "type": ["string", "null"] },
          "assetClass": { "type": ["string", "null"] },
          "status": {
            "type": "string",
            "enum": ["active", "pending_settlement", "locked", "archived"],
            "description": "Holding status",
            "example": "active"
          },
          "createdAt": { "type": "string", "format": "date-time" },
          "updatedAt": { "type": "string", "format": "date-time" }
        },
        "required": ["id", "ticker", "name", "shares", "purchasePrice", "purchaseDate"]
      },
      "Dividend": {
        "type": "object",
        "properties": {
          "id": { "type": "integer", "format": "int64" },
          "ticker": { "type": "string" },
          "amount": { "type": "number" },
          "shares": { "type": "number" },
          "date": { "type": "string", "format": "date" },
          "createdAt": { "type": "string", "format": "date-time" }
        },
        "required": ["id", "ticker", "amount", "shares", "date"]
      },
      "Transaction": {
        "type": "object",
        "properties": {
          "id": { "type": "integer", "format": "int64" },
          "type": { "type": "string", "enum": ["buy", "sell", "dividend"] },
          "ticker": { "type": "string" },
          "shares": { "type": "number" },
          "price": { "type": "number" },
          "fees": { "type": "number" },
          "date": { "type": "string", "format": "date" },
          "createdAt": { "type": "string", "format": "date-time" }
        },
        "required": ["id", "type", "ticker", "shares", "price", "date"]
      },
      "MarketData": {
        "type": "object",
        "properties": {
          "symbol": {
            "type": "string",
            "description": "Stock ticker symbol",
            "example": "AAPL"
          },
          "currentPrice": {
            "type": "number",
            "format": "double",
            "description": "Current stock price in USD",
            "example": 271.49
          },
          "companyName": {
            "type": "string",
            "description": "Company name",
            "example": "Apple Inc"
          },
          "changePercent": {
            "type": "number",
            "format": "double",
            "description": "Percentage change from previous close",
            "example": 1.97,
            "nullable": true
          },
          "lastUpdated": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when data was last updated"
          },
          "cached": {
            "type": "boolean",
            "description": "Whether the data was served from cache (true) or fetched fresh from API (false)",
            "example": false
          }
        },
        "required": ["symbol", "currentPrice", "companyName", "lastUpdated"]
      },
      "AuditLog": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "Audit log entry ID",
            "example": 12345
          },
          "userId": {
            "type": "integer",
            "format": "int64",
            "description": "User who performed the action",
            "example": 42
          },
          "eventType": {
            "type": "string",
            "description": "Event type identifier",
            "example": "login_success"
          },
          "eventCategory": {
            "type": "string",
            "enum": ["authentication", "admin", "account", "data", "bull_pen", "security"],
            "description": "Event category",
            "example": "authentication"
          },
          "description": {
            "type": "string",
            "description": "Human-readable event description",
            "example": "User logged in successfully via Google OAuth"
          },
          "ipAddress": {
            "type": "string",
            "nullable": true,
            "description": "IP address of the request (IPv4 or IPv6)",
            "example": "192.168.1.100"
          },
          "userAgent": {
            "type": "string",
            "nullable": true,
            "description": "Browser/client user agent string",
            "example": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36"
          },
          "previousValues": {
            "type": "object",
            "nullable": true,
            "description": "Previous state before the action (for updates/deletes)",
            "example": { "is_admin": false }
          },
          "newValues": {
            "type": "object",
            "nullable": true,
            "description": "New state after the action (for creates/updates)",
            "example": { "is_admin": true, "changed_by": "admin@example.com" }
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "Event timestamp",
            "example": "2025-11-25T14:22:00Z"
          }
        },
        "required": ["id", "userId", "eventType", "eventCategory", "createdAt"]
      }
    }
  }
}

