{
  "openapi": "3.0.3",
  "info": {
    "title": "Portfolio Tracker API",
    "version": "1.2.0",
    "description": "Backend API for the Portfolio Tracker application (Node.js + Express + MySQL). Includes comprehensive audit logging, soft delete functionality, user/holding status management, and Stars System gamification with achievement rules and composite ranking scores."
  },
  "servers": [
    {
      "url": "https://www.bahar.co.il/fantasybroker-api",
      "description": "Production server"
    },
    {
      "url": "http://localhost:4000",
      "description": "Local development server"
    }
  ],
  "paths": {
    "/api/health": {
      "get": {
        "summary": "Health check",
        "description": "Returns basic health information to verify the API is running.",
        "tags": ["System"],
        "responses": {
          "200": {
            "description": "API is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "ok"
                    },
                    "db": {
                      "type": "string",
                      "example": "ok"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/google": {
      "post": {
        "summary": "Authenticate with Google",
        "description": "Accepts a Google ID token (credential) from the frontend, verifies it with Google, upserts the user in the database, and returns a backend JWT and user profile.",
        "tags": ["Auth"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "credential": {
                    "type": "string",
                    "description": "Google ID token (JWT) returned by Google Identity Services."
                  }
                },
                "required": ["credential"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                }
              }
            }
          },
          "400": {
            "description": "Missing or invalid request body",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Invalid or expired Google token",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/holdings": {
      "get": {
        "summary": "List holdings",
        "description": "Returns the current user's holdings.",
        "tags": ["Holdings"],
        "security": [
          { "BearerAuth": [] }
        ],
        "responses": {
          "200": {
            "description": "List of holdings for the current user.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "holdings": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": { "type": "integer", "format": "int64" },
                          "ticker": { "type": "string" },
                          "name": { "type": "string" },
                          "shares": { "type": "number" },
                          "purchasePrice": { "type": "number" },
                          "purchaseDate": { "type": "string", "format": "date" },
                          "sector": { "type": ["string", "null"] },
                          "assetClass": { "type": ["string", "null"] },
                          "createdAt": { "type": "string", "format": "date-time" },
                          "updatedAt": { "type": "string", "format": "date-time" }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Create holding",
        "description": "Creates a new holding for the current user.",
        "tags": ["Holdings"],
        "security": [
          { "BearerAuth": [] }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "ticker": { "type": "string" },
                  "name": { "type": "string" },
                  "shares": { "type": "number" },
                  "purchasePrice": { "type": "number" },
                  "purchaseDate": { "type": "string", "format": "date" },
                  "sector": { "type": "string" },
                  "assetClass": { "type": "string" }
                },
                "required": ["ticker", "name", "shares", "purchasePrice", "purchaseDate"]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Holding created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "holding": { "$ref": "#/components/schemas/Holding" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/holdings/{id}": {
      "put": {
        "summary": "Update holding",
        "description": "Updates an existing holding for the current user.",
        "tags": ["Holdings"],
        "security": [
          { "BearerAuth": [] }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer", "format": "int64" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "ticker": { "type": "string" },
                  "name": { "type": "string" },
                  "shares": { "type": "number" },
                  "purchasePrice": { "type": "number" },
                  "purchaseDate": { "type": "string", "format": "date" },
                  "sector": { "type": "string" },
                  "assetClass": { "type": "string" }
                },
                "required": ["ticker", "name", "shares", "purchasePrice", "purchaseDate"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Holding updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "holding": { "$ref": "#/components/schemas/Holding" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Holding not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Delete holding",
        "description": "Deletes an existing holding for the current user.",
        "tags": ["Holdings"],
        "security": [
          { "BearerAuth": [] }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer", "format": "int64" }
          }
        ],
        "responses": {
          "204": {
            "description": "Holding deleted"
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Holding not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/dividends": {
      "get": {
        "summary": "List dividends",
        "description": "Returns the current user's dividends.",
        "tags": ["Dividends"],
        "security": [
          { "BearerAuth": [] }
        ],
        "responses": {
          "200": {
            "description": "List of dividends for the current user.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "dividends": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": { "type": "integer", "format": "int64" },
                          "ticker": { "type": "string" },
                          "amount": { "type": "number" },
                          "shares": { "type": "number" },
                          "date": { "type": "string", "format": "date" },
                          "createdAt": { "type": "string", "format": "date-time" }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Create dividend",
        "description": "Creates a new dividend for the current user.",
        "tags": ["Dividends"],
        "security": [
          { "BearerAuth": [] }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "ticker": { "type": "string" },
                  "amount": { "type": "number" },
                  "shares": { "type": "number" },
                  "date": { "type": "string", "format": "date" }
                },
                "required": ["ticker", "amount", "shares", "date"]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Dividend created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "dividend": { "$ref": "#/components/schemas/Dividend" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/dividends/{id}": {
      "put": {
        "summary": "Update dividend",
        "description": "Updates an existing dividend for the current user.",
        "tags": ["Dividends"],
        "security": [
          { "BearerAuth": [] }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer", "format": "int64" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "ticker": { "type": "string" },
                  "amount": { "type": "number" },
                  "shares": { "type": "number" },
                  "date": { "type": "string", "format": "date" }
                },
                "required": ["ticker", "amount", "shares", "date"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Dividend updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "dividend": { "$ref": "#/components/schemas/Dividend" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Dividend not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Delete dividend",
        "description": "Deletes an existing dividend for the current user.",
        "tags": ["Dividends"],
        "security": [
          { "BearerAuth": [] }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer", "format": "int64" }
          }
        ],
        "responses": {
          "204": {
            "description": "Dividend deleted"
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Dividend not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/transactions": {
      "get": {
        "summary": "List transactions",
        "description": "Returns the current user's transactions.",
        "tags": ["Transactions"],
        "security": [
          { "BearerAuth": [] }
        ],
        "responses": {
          "200": {
            "description": "List of transactions for the current user.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "transactions": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": { "type": "integer", "format": "int64" },
                          "type": { "type": "string", "enum": ["buy", "sell", "dividend"] },
                          "ticker": { "type": "string" },
                          "shares": { "type": "number" },
                          "price": { "type": "number" },
                          "fees": { "type": "number" },
                          "date": { "type": "string", "format": "date" },
                          "createdAt": { "type": "string", "format": "date-time" }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Create transaction",
        "description": "Creates a new transaction for the current user.",
        "tags": ["Transactions"],
        "security": [
          { "BearerAuth": [] }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "type": { "type": "string", "enum": ["buy", "sell", "dividend"] },
                  "ticker": { "type": "string" },
                  "shares": { "type": "number" },
                  "price": { "type": "number" },
                  "fees": { "type": "number" },
                  "date": { "type": "string", "format": "date" }
                },
                "required": ["type", "ticker", "shares", "price", "date"]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Transaction created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "transaction": { "$ref": "#/components/schemas/Transaction" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/transactions/{id}": {
      "put": {
        "summary": "Update transaction",
        "description": "Updates an existing transaction for the current user.",
        "tags": ["Transactions"],
        "security": [
          { "BearerAuth": [] }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer", "format": "int64" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "type": { "type": "string", "enum": ["buy", "sell", "dividend"] },
                  "ticker": { "type": "string" },
                  "shares": { "type": "number" },
                  "price": { "type": "number" },
                  "fees": { "type": "number" },
                  "date": { "type": "string", "format": "date" }
                },
                "required": ["type", "ticker", "shares", "price", "date"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Transaction updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "transaction": { "$ref": "#/components/schemas/Transaction" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Transaction not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Delete transaction",
        "description": "Deletes an existing transaction for the current user.",
        "tags": ["Transactions"],
        "security": [
          { "BearerAuth": [] }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer", "format": "int64" }
          }
        ],
        "responses": {
          "204": {
            "description": "Transaction deleted"
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Transaction not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/portfolio/all": {
      "get": {
        "summary": "Get full portfolio",
        "description": "Returns holdings, dividends, and transactions for the current user.",
        "tags": ["Portfolio"],
        "security": [
          { "BearerAuth": [] }
        ],
        "responses": {
          "200": {
            "description": "Full portfolio for the current user.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "holdings": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/Holding" }
                    },
                    "dividends": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/Dividend" }
                    },
                    "transactions": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/Transaction" }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Unexpected server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/market-data/{symbol}": {
      "get": {
        "summary": "Get market data for a stock symbol",
        "description": "Returns real-time market data for a single stock symbol from Finnhub API. Data is cached for 15 minutes to minimize API calls.",
        "tags": ["Market Data"],
        "parameters": [
          {
            "name": "symbol",
            "in": "path",
            "required": true,
            "description": "Stock ticker symbol (e.g., AAPL, GOOGL, TSLA)",
            "schema": {
              "type": "string",
              "example": "AAPL"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Market data for the requested symbol",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MarketData"
                }
              }
            }
          },
          "500": {
            "description": "Failed to fetch market data",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/market-data": {
      "get": {
        "summary": "Get market data for multiple stock symbols",
        "description": "Returns real-time market data for multiple stock symbols from Finnhub API. Maximum 50 symbols per request. Data is cached for 15 minutes.",
        "tags": ["Market Data"],
        "parameters": [
          {
            "name": "symbols",
            "in": "query",
            "required": true,
            "description": "Comma-separated list of stock ticker symbols (e.g., AAPL,GOOGL,TSLA)",
            "schema": {
              "type": "string",
              "example": "AAPL,GOOGL,TSLA"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Market data for the requested symbols",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/MarketData" }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request (missing symbols or too many symbols)",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Failed to fetch market data",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/admin/users": {
      "get": {
        "summary": "List all users (Admin only)",
        "description": "Returns a list of all users in the system. Requires admin privileges.",
        "tags": ["Admin"],
        "security": [
          { "BearerAuth": [] }
        ],
        "responses": {
          "200": {
            "description": "List of users",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "users": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": { "type": "integer" },
                          "email": { "type": "string" },
                          "name": { "type": "string" },
                          "authProvider": { "type": "string" },
                          "isDemo": { "type": "boolean" },
                          "isAdmin": { "type": "boolean" },
                          "status": { "type": "string" },
                          "createdAt": { "type": "string", "format": "date-time" },
                          "lastLogin": { "type": "string", "format": "date-time", "nullable": true }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Admin privileges required",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/admin/users/{id}/logs": {
      "get": {
        "summary": "Get user audit logs (Admin only)",
        "description": "Returns audit logs for a specific user. Requires admin privileges.",
        "tags": ["Admin"],
        "security": [
          { "BearerAuth": [] }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" },
            "description": "User ID"
          }
        ],
        "responses": {
          "200": {
            "description": "User audit logs",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": { "type": "integer" },
                        "email": { "type": "string" },
                        "name": { "type": "string" }
                      }
                    },
                    "logs": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/AuditLog"
                      }
                    },
                    "total": { "type": "integer" }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Admin privileges required",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "User not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/admin/users/{id}/admin": {
      "patch": {
        "summary": "Update user admin status (Admin only)",
        "description": "Grant or revoke admin privileges for a user. Requires admin privileges. Cannot remove your own admin status.",
        "tags": ["Admin"],
        "security": [
          { "BearerAuth": [] }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" },
            "description": "User ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "isAdmin": {
                    "type": "boolean",
                    "description": "Set to true to grant admin privileges, false to revoke"
                  }
                },
                "required": ["isAdmin"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Admin status updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "message": { "type": "string" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request - Invalid input",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Admin privileges required or cannot remove own admin status",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "User not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/v1/budget": {
      "get": {
        "summary": "Get current user budget",
        "description": "Returns the current budget state for the authenticated user, including available and locked balances.",
        "tags": ["Budget"],
        "security": [{ "BearerAuth": [] }],
        "responses": {
          "200": {
            "description": "Current budget retrieved successfully",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/UserBudget" }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid JWT token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Budget not found for user",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/v1/budget/logs": {
      "get": {
        "summary": "Get user budget logs",
        "description": "Returns paginated budget transaction history for the authenticated user with optional filtering.",
        "tags": ["Budget"],
        "security": [{ "BearerAuth": [] }],
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "description": "Number of records to return (default: 50)",
            "schema": { "type": "integer", "default": 50 }
          },
          {
            "name": "offset",
            "in": "query",
            "description": "Number of records to skip (default: 0)",
            "schema": { "type": "integer", "default": 0 }
          },
          {
            "name": "operation_type",
            "in": "query",
            "description": "Filter by operation type (e.g., ROOM_BUY_IN, TRANSFER_OUT)",
            "schema": { "type": "string" }
          },
          {
            "name": "bull_pen_id",
            "in": "query",
            "description": "Filter by bull pen (trading room) ID",
            "schema": { "type": "integer" }
          }
        ],
        "responses": {
          "200": {
            "description": "Budget logs retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/BudgetLog" }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid JWT token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/internal/v1/budget/credit": {
      "post": {
        "summary": "Credit user budget (Internal)",
        "description": "Internal service endpoint to credit a user's budget. Requires service token authentication and idempotency key.",
        "tags": ["Budget - Internal"],
        "security": [{ "ServiceTokenAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/BudgetCreditRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Budget credited successfully",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/BudgetOperationResponse" }
              }
            }
          },
          "400": {
            "description": "Bad request - Invalid input or insufficient funds",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Invalid service token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Budget not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/internal/v1/budget/debit": {
      "post": {
        "summary": "Debit user budget (Internal)",
        "description": "Internal service endpoint to debit a user's budget. Requires service token authentication and idempotency key.",
        "tags": ["Budget - Internal"],
        "security": [{ "ServiceTokenAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/BudgetDebitRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Budget debited successfully",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/BudgetOperationResponse" }
              }
            }
          },
          "400": {
            "description": "Bad request - Invalid input or insufficient funds",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Invalid service token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Budget not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/internal/v1/budget/lock": {
      "post": {
        "summary": "Lock user budget funds (Internal)",
        "description": "Internal service endpoint to lock funds (move from available to locked balance). Used for pending room entries.",
        "tags": ["Budget - Internal"],
        "security": [{ "ServiceTokenAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/BudgetLockRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Funds locked successfully",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/BudgetLockResponse" }
              }
            }
          },
          "400": {
            "description": "Bad request - Invalid input or insufficient funds",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Invalid service token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Budget not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/internal/v1/budget/unlock": {
      "post": {
        "summary": "Unlock user budget funds (Internal)",
        "description": "Internal service endpoint to unlock funds (move from locked back to available balance). Used on room cancel or join failure.",
        "tags": ["Budget - Internal"],
        "security": [{ "ServiceTokenAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/BudgetUnlockRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Funds unlocked successfully",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/BudgetUnlockResponse" }
              }
            }
          },
          "400": {
            "description": "Bad request - Invalid input or insufficient locked funds",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Invalid service token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Budget not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/internal/v1/budget/transfer": {
      "post": {
        "summary": "Transfer budget between users (Internal)",
        "description": "Internal service endpoint for atomic user-to-user budget transfers. Locks both budgets in deterministic order and creates two log entries.",
        "tags": ["Budget - Internal"],
        "security": [{ "ServiceTokenAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/BudgetTransferRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Transfer completed successfully",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/BudgetTransferResponse" }
              }
            }
          },
          "400": {
            "description": "Bad request - Invalid input or insufficient funds",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Invalid service token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Budget not found for one or both users",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/internal/v1/budget/adjust": {
      "post": {
        "summary": "Adjust user budget (Internal - Admin)",
        "description": "Internal service endpoint for admin budget adjustments (credits or debits). Used for manual corrections and support tickets.",
        "tags": ["Budget - Internal"],
        "security": [{ "ServiceTokenAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/BudgetAdjustRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Budget adjusted successfully",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/BudgetOperationResponse" }
              }
            }
          },
          "400": {
            "description": "Bad request - Invalid input or insufficient funds",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Invalid service token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Budget not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/admin/achievement-rules": {
      "get": {
        "summary": "List all achievement rules (Admin only)",
        "description": "Returns a list of all achievement rules with filtering and sorting options.",
        "tags": ["Achievement Rules"],
        "security": [{ "BearerAuth": [] }],
        "parameters": [
          {
            "name": "category",
            "in": "query",
            "description": "Filter by category (performance, engagement, seasonal, admin)",
            "schema": { "type": "string" }
          },
          {
            "name": "is_active",
            "in": "query",
            "description": "Filter by active status (true/false)",
            "schema": { "type": "boolean" }
          }
        ],
        "responses": {
          "200": {
            "description": "List of achievement rules",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "rules": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/AchievementRule" }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Admin privileges required",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Create a new achievement rule (Admin only)",
        "description": "Creates a new achievement rule with specified parameters.",
        "tags": ["Achievement Rules"],
        "security": [{ "BearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/CreateAchievementRuleRequest" }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Achievement rule created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "message": { "type": "string" },
                    "ruleId": { "type": "integer" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request - Missing required fields",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Admin privileges required",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/admin/achievement-rules/{id}": {
      "get": {
        "summary": "Get a specific achievement rule (Admin only)",
        "description": "Returns details of a specific achievement rule by ID.",
        "tags": ["Achievement Rules"],
        "security": [{ "BearerAuth": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "description": "Achievement rule ID",
            "schema": { "type": "integer" }
          }
        ],
        "responses": {
          "200": {
            "description": "Achievement rule details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "rule": { "$ref": "#/components/schemas/AchievementRule" }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Admin privileges required",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Achievement rule not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      },
      "patch": {
        "summary": "Update an achievement rule (Admin only)",
        "description": "Updates specific fields of an achievement rule.",
        "tags": ["Achievement Rules"],
        "security": [{ "BearerAuth": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "description": "Achievement rule ID",
            "schema": { "type": "integer" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/UpdateAchievementRuleRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Achievement rule updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "message": { "type": "string" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request - No fields to update",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Admin privileges required",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "404": {
            "description": "Achievement rule not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      },
      "ServiceTokenAuth": {
        "type": "http",
        "scheme": "bearer",
        "description": "Service-to-service authentication using INTERNAL_SERVICE_TOKEN"
      }
    },
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "example": 123
          },
          "email": {
            "type": "string",
            "format": "email",
            "example": "user@example.com"
          },
          "name": {
            "type": "string",
            "example": "Demo User"
          },
          "profilePicture": {
            "type": "string",
            "format": "uri",
            "nullable": true,
            "example": "https://example.com/avatar.png"
          },
          "authProvider": {
            "type": "string",
            "description": "Authentication provider used for this account.",
            "example": "google"
          },
          "isDemo": {
            "type": "boolean",
            "example": false
          },
          "isAdmin": {
            "type": "boolean",
            "description": "TRUE if user has admin privileges",
            "example": false
          },
          "status": {
            "type": "string",
            "enum": ["active", "inactive", "archived", "pending_verification", "invited", "suspended", "deleted"],
            "description": "User account status",
            "example": "active"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "Account creation timestamp",
            "example": "2025-01-15T10:30:00Z"
          },
          "lastLogin": {
            "type": "string",
            "format": "date-time",
            "nullable": true,
            "description": "Last login timestamp",
            "example": "2025-11-25T14:22:00Z"
          }
        },
        "required": ["id", "email", "authProvider", "isDemo"]
      },
      "AuthResponse": {
        "type": "object",
        "properties": {
          "user": {
            "$ref": "#/components/schemas/User"
          },
          "token": {
            "type": "string",
            "description": "Backend JWT used for authenticating subsequent API requests."
          }
        },
        "required": ["user", "token"]
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "example": "Invalid or expired Google token"
          }
        },
        "required": ["error"]
      },
      "Holding": {
        "type": "object",
        "properties": {
          "id": { "type": "integer", "format": "int64" },
          "ticker": { "type": "string" },
          "name": { "type": "string" },
          "shares": { "type": "number" },
          "purchasePrice": { "type": "number" },
          "purchaseDate": { "type": "string", "format": "date" },
          "sector": { "type": ["string", "null"] },
          "assetClass": { "type": ["string", "null"] },
          "status": {
            "type": "string",
            "enum": ["active", "pending_settlement", "locked", "archived"],
            "description": "Holding status",
            "example": "active"
          },
          "createdAt": { "type": "string", "format": "date-time" },
          "updatedAt": { "type": "string", "format": "date-time" }
        },
        "required": ["id", "ticker", "name", "shares", "purchasePrice", "purchaseDate"]
      },
      "Dividend": {
        "type": "object",
        "properties": {
          "id": { "type": "integer", "format": "int64" },
          "ticker": { "type": "string" },
          "amount": { "type": "number" },
          "shares": { "type": "number" },
          "date": { "type": "string", "format": "date" },
          "createdAt": { "type": "string", "format": "date-time" }
        },
        "required": ["id", "ticker", "amount", "shares", "date"]
      },
      "Transaction": {
        "type": "object",
        "properties": {
          "id": { "type": "integer", "format": "int64" },
          "type": { "type": "string", "enum": ["buy", "sell", "dividend"] },
          "ticker": { "type": "string" },
          "shares": { "type": "number" },
          "price": { "type": "number" },
          "fees": { "type": "number" },
          "date": { "type": "string", "format": "date" },
          "createdAt": { "type": "string", "format": "date-time" }
        },
        "required": ["id", "type", "ticker", "shares", "price", "date"]
      },
      "MarketData": {
        "type": "object",
        "properties": {
          "symbol": {
            "type": "string",
            "description": "Stock ticker symbol",
            "example": "AAPL"
          },
          "currentPrice": {
            "type": "number",
            "format": "double",
            "description": "Current stock price in USD",
            "example": 271.49
          },
          "companyName": {
            "type": "string",
            "description": "Company name",
            "example": "Apple Inc"
          },
          "changePercent": {
            "type": "number",
            "format": "double",
            "description": "Percentage change from previous close",
            "example": 1.97,
            "nullable": true
          },
          "lastUpdated": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when data was last updated"
          },
          "cached": {
            "type": "boolean",
            "description": "Whether the data was served from cache (true) or fetched fresh from API (false)",
            "example": false
          }
        },
        "required": ["symbol", "currentPrice", "companyName", "lastUpdated"]
      },
      "AuditLog": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "Audit log entry ID",
            "example": 12345
          },
          "userId": {
            "type": "integer",
            "format": "int64",
            "description": "User who performed the action",
            "example": 42
          },
          "eventType": {
            "type": "string",
            "description": "Event type identifier",
            "example": "login_success"
          },
          "eventCategory": {
            "type": "string",
            "enum": ["authentication", "admin", "account", "data", "bull_pen", "security"],
            "description": "Event category",
            "example": "authentication"
          },
          "description": {
            "type": "string",
            "description": "Human-readable event description",
            "example": "User logged in successfully via Google OAuth"
          },
          "ipAddress": {
            "type": "string",
            "nullable": true,
            "description": "IP address of the request (IPv4 or IPv6)",
            "example": "192.168.1.100"
          },
          "userAgent": {
            "type": "string",
            "nullable": true,
            "description": "Browser/client user agent string",
            "example": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36"
          },
          "previousValues": {
            "type": "object",
            "nullable": true,
            "description": "Previous state before the action (for updates/deletes)",
            "example": { "is_admin": false }
          },
          "newValues": {
            "type": "object",
            "nullable": true,
            "description": "New state after the action (for creates/updates)",
            "example": { "is_admin": true, "changed_by": "admin@example.com" }
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "Event timestamp",
            "example": "2025-11-25T14:22:00Z"
          }
        },
        "required": ["id", "userId", "eventType", "eventCategory", "createdAt"]
      },
      "UserBudget": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "Budget record ID",
            "example": 1
          },
          "user_id": {
            "type": "integer",
            "format": "int64",
            "description": "User ID",
            "example": 123
          },
          "available_balance": {
            "type": "number",
            "format": "double",
            "description": "Available balance (can be spent)",
            "example": 1200.50
          },
          "locked_balance": {
            "type": "number",
            "format": "double",
            "description": "Locked balance (pending operations)",
            "example": 100.00
          },
          "total_balance": {
            "type": "number",
            "format": "double",
            "description": "Total balance (available + locked)",
            "example": 1300.50
          },
          "currency": {
            "type": "string",
            "description": "Currency code",
            "example": "VUSD"
          },
          "status": {
            "type": "string",
            "enum": ["active", "frozen"],
            "description": "Budget status",
            "example": "active"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "Creation timestamp"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "Last update timestamp"
          }
        },
        "required": ["id", "user_id", "available_balance", "locked_balance", "currency", "status"]
      },
      "BudgetLog": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "Log entry ID",
            "example": 1001
          },
          "user_id": {
            "type": "integer",
            "format": "int64",
            "description": "User ID",
            "example": 123
          },
          "direction": {
            "type": "string",
            "enum": ["IN", "OUT", "LOCK", "UNLOCK"],
            "description": "Transaction direction",
            "example": "OUT"
          },
          "operation_type": {
            "type": "string",
            "description": "Operation type identifier",
            "example": "ROOM_BUY_IN"
          },
          "amount": {
            "type": "number",
            "format": "double",
            "description": "Transaction amount",
            "example": 100.00
          },
          "currency": {
            "type": "string",
            "description": "Currency code",
            "example": "VUSD"
          },
          "balance_before": {
            "type": "number",
            "format": "double",
            "description": "Balance before transaction",
            "example": 1300.50
          },
          "balance_after": {
            "type": "number",
            "format": "double",
            "description": "Balance after transaction",
            "example": 1200.50
          },
          "correlation_id": {
            "type": "string",
            "nullable": true,
            "description": "Correlation ID for tracing related operations",
            "example": "room-45-join-uuid"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "Transaction timestamp"
          }
        },
        "required": ["id", "user_id", "direction", "operation_type", "amount", "currency", "balance_before", "balance_after"]
      },
      "BudgetCreditRequest": {
        "type": "object",
        "properties": {
          "user_id": {
            "type": "integer",
            "format": "int64",
            "description": "User ID to credit",
            "example": 123
          },
          "amount": {
            "type": "number",
            "format": "double",
            "description": "Amount to credit (positive)",
            "example": 100.00
          },
          "currency": {
            "type": "string",
            "description": "Currency code (optional, default VUSD)",
            "example": "VUSD"
          },
          "operation_type": {
            "type": "string",
            "description": "Operation type identifier",
            "example": "ROOM_PAYOUT"
          },
          "bull_pen_id": {
            "type": "integer",
            "nullable": true,
            "description": "Associated trading room ID",
            "example": 45
          },
          "season_id": {
            "type": "integer",
            "nullable": true,
            "description": "Associated season ID",
            "example": 3
          },
          "correlation_id": {
            "type": "string",
            "nullable": true,
            "description": "Correlation ID for tracing",
            "example": "room-45-settlement-uuid"
          },
          "meta": {
            "type": "object",
            "nullable": true,
            "description": "Additional metadata",
            "example": { "reason": "Room settlement payout" }
          }
        },
        "required": ["user_id", "amount", "operation_type"]
      },
      "BudgetDebitRequest": {
        "type": "object",
        "properties": {
          "user_id": {
            "type": "integer",
            "format": "int64",
            "description": "User ID to debit",
            "example": 123
          },
          "amount": {
            "type": "number",
            "format": "double",
            "description": "Amount to debit (positive)",
            "example": 100.00
          },
          "currency": {
            "type": "string",
            "description": "Currency code (optional, default VUSD)",
            "example": "VUSD"
          },
          "operation_type": {
            "type": "string",
            "description": "Operation type identifier",
            "example": "ROOM_BUY_IN"
          },
          "bull_pen_id": {
            "type": "integer",
            "nullable": true,
            "description": "Associated trading room ID",
            "example": 45
          },
          "season_id": {
            "type": "integer",
            "nullable": true,
            "description": "Associated season ID",
            "example": 3
          },
          "correlation_id": {
            "type": "string",
            "nullable": true,
            "description": "Correlation ID for tracing",
            "example": "room-45-join-uuid"
          },
          "meta": {
            "type": "object",
            "nullable": true,
            "description": "Additional metadata",
            "example": { "reason": "Room buy-in" }
          }
        },
        "required": ["user_id", "amount", "operation_type"]
      },
      "BudgetLockRequest": {
        "type": "object",
        "properties": {
          "user_id": {
            "type": "integer",
            "format": "int64",
            "description": "User ID",
            "example": 123
          },
          "amount": {
            "type": "number",
            "format": "double",
            "description": "Amount to lock (positive)",
            "example": 100.00
          },
          "currency": {
            "type": "string",
            "description": "Currency code (optional, default VUSD)",
            "example": "VUSD"
          },
          "operation_type": {
            "type": "string",
            "description": "Operation type identifier",
            "example": "ROOM_BUY_IN_LOCK"
          },
          "bull_pen_id": {
            "type": "integer",
            "nullable": true,
            "description": "Associated trading room ID",
            "example": 45
          },
          "season_id": {
            "type": "integer",
            "nullable": true,
            "description": "Associated season ID",
            "example": 3
          },
          "correlation_id": {
            "type": "string",
            "nullable": true,
            "description": "Correlation ID for tracing",
            "example": "room-45-join-uuid"
          },
          "meta": {
            "type": "object",
            "nullable": true,
            "description": "Additional metadata"
          }
        },
        "required": ["user_id", "amount", "operation_type"]
      },
      "BudgetUnlockRequest": {
        "type": "object",
        "properties": {
          "user_id": {
            "type": "integer",
            "format": "int64",
            "description": "User ID",
            "example": 123
          },
          "amount": {
            "type": "number",
            "format": "double",
            "description": "Amount to unlock (positive)",
            "example": 100.00
          },
          "currency": {
            "type": "string",
            "description": "Currency code (optional, default VUSD)",
            "example": "VUSD"
          },
          "operation_type": {
            "type": "string",
            "description": "Operation type identifier",
            "example": "ROOM_BUY_IN_UNLOCK"
          },
          "bull_pen_id": {
            "type": "integer",
            "nullable": true,
            "description": "Associated trading room ID",
            "example": 45
          },
          "season_id": {
            "type": "integer",
            "nullable": true,
            "description": "Associated season ID",
            "example": 3
          },
          "correlation_id": {
            "type": "string",
            "nullable": true,
            "description": "Correlation ID for tracing",
            "example": "room-45-join-uuid"
          },
          "meta": {
            "type": "object",
            "nullable": true,
            "description": "Additional metadata"
          }
        },
        "required": ["user_id", "amount", "operation_type"]
      },
      "BudgetTransferRequest": {
        "type": "object",
        "properties": {
          "from_user_id": {
            "type": "integer",
            "format": "int64",
            "description": "Source user ID",
            "example": 123
          },
          "to_user_id": {
            "type": "integer",
            "format": "int64",
            "description": "Destination user ID",
            "example": 456
          },
          "amount": {
            "type": "number",
            "format": "double",
            "description": "Amount to transfer (positive)",
            "example": 50.00
          },
          "currency": {
            "type": "string",
            "description": "Currency code (optional, default VUSD)",
            "example": "VUSD"
          },
          "operation_type_out": {
            "type": "string",
            "description": "Operation type for outgoing transaction (optional, default TRANSFER_OUT)",
            "example": "TRANSFER_OUT"
          },
          "operation_type_in": {
            "type": "string",
            "description": "Operation type for incoming transaction (optional, default TRANSFER_IN)",
            "example": "TRANSFER_IN"
          },
          "correlation_id": {
            "type": "string",
            "nullable": true,
            "description": "Correlation ID for tracing",
            "example": "transfer-uuid"
          },
          "meta": {
            "type": "object",
            "nullable": true,
            "description": "Additional metadata",
            "example": { "reason": "Friendly stake" }
          }
        },
        "required": ["from_user_id", "to_user_id", "amount"]
      },
      "BudgetAdjustRequest": {
        "type": "object",
        "properties": {
          "user_id": {
            "type": "integer",
            "format": "int64",
            "description": "User ID to adjust",
            "example": 123
          },
          "amount": {
            "type": "number",
            "format": "double",
            "description": "Amount to adjust (positive)",
            "example": 20.00
          },
          "direction": {
            "type": "string",
            "enum": ["IN", "OUT"],
            "description": "Direction of adjustment",
            "example": "IN"
          },
          "currency": {
            "type": "string",
            "description": "Currency code (optional, default VUSD)",
            "example": "VUSD"
          },
          "operation_type": {
            "type": "string",
            "description": "Operation type (optional, default ADJUSTMENT)",
            "example": "ADJUSTMENT_CREDIT"
          },
          "created_by": {
            "type": "string",
            "nullable": true,
            "description": "Admin identifier",
            "example": "admin:42"
          },
          "correlation_id": {
            "type": "string",
            "nullable": true,
            "description": "Correlation ID for tracing",
            "example": "support-ticket-uuid"
          },
          "meta": {
            "type": "object",
            "nullable": true,
            "description": "Additional metadata",
            "example": { "ticket_id": "SUP-12345", "reason": "Manual correction" }
          }
        },
        "required": ["user_id", "amount", "direction"]
      },
      "BudgetOperationResponse": {
        "type": "object",
        "properties": {
          "user_id": {
            "type": "integer",
            "format": "int64",
            "description": "User ID",
            "example": 123
          },
          "balance_before": {
            "type": "number",
            "format": "double",
            "description": "Balance before operation",
            "example": 1300.50
          },
          "balance_after": {
            "type": "number",
            "format": "double",
            "description": "Balance after operation",
            "example": 1200.50
          },
          "log_id": {
            "type": "integer",
            "format": "int64",
            "description": "Budget log entry ID",
            "example": 1001
          },
          "idempotent": {
            "type": "boolean",
            "description": "Whether this was an idempotent retry",
            "example": false
          }
        },
        "required": ["user_id", "balance_before", "balance_after", "log_id", "idempotent"]
      },
      "BudgetLockResponse": {
        "type": "object",
        "properties": {
          "user_id": {
            "type": "integer",
            "format": "int64",
            "description": "User ID",
            "example": 123
          },
          "balance_before": {
            "type": "number",
            "format": "double",
            "description": "Available balance before lock",
            "example": 1300.50
          },
          "balance_after": {
            "type": "number",
            "format": "double",
            "description": "Available balance after lock",
            "example": 1200.50
          },
          "locked_balance": {
            "type": "number",
            "format": "double",
            "description": "New locked balance",
            "example": 100.00
          },
          "log_id": {
            "type": "integer",
            "format": "int64",
            "description": "Budget log entry ID",
            "example": 1001
          },
          "idempotent": {
            "type": "boolean",
            "description": "Whether this was an idempotent retry",
            "example": false
          }
        },
        "required": ["user_id", "balance_before", "balance_after", "locked_balance", "log_id", "idempotent"]
      },
      "BudgetUnlockResponse": {
        "type": "object",
        "properties": {
          "user_id": {
            "type": "integer",
            "format": "int64",
            "description": "User ID",
            "example": 123
          },
          "balance_before": {
            "type": "number",
            "format": "double",
            "description": "Locked balance before unlock",
            "example": 100.00
          },
          "balance_after": {
            "type": "number",
            "format": "double",
            "description": "Locked balance after unlock",
            "example": 0.00
          },
          "available_balance": {
            "type": "number",
            "format": "double",
            "description": "New available balance",
            "example": 1300.50
          },
          "log_id": {
            "type": "integer",
            "format": "int64",
            "description": "Budget log entry ID",
            "example": 1001
          },
          "idempotent": {
            "type": "boolean",
            "description": "Whether this was an idempotent retry",
            "example": false
          }
        },
        "required": ["user_id", "balance_before", "balance_after", "available_balance", "log_id", "idempotent"]
      },
      "BudgetTransferResponse": {
        "type": "object",
        "properties": {
          "from_user_id": {
            "type": "integer",
            "format": "int64",
            "description": "Source user ID",
            "example": 123
          },
          "to_user_id": {
            "type": "integer",
            "format": "int64",
            "description": "Destination user ID",
            "example": 456
          },
          "amount": {
            "type": "number",
            "format": "double",
            "description": "Amount transferred",
            "example": 50.00
          },
          "from_balance_before": {
            "type": "number",
            "format": "double",
            "description": "Source balance before transfer",
            "example": 100.00
          },
          "from_balance_after": {
            "type": "number",
            "format": "double",
            "description": "Source balance after transfer",
            "example": 50.00
          },
          "to_balance_before": {
            "type": "number",
            "format": "double",
            "description": "Destination balance before transfer",
            "example": 200.00
          },
          "to_balance_after": {
            "type": "number",
            "format": "double",
            "description": "Destination balance after transfer",
            "example": 250.00
          },
          "from_log_id": {
            "type": "integer",
            "format": "int64",
            "description": "Source user's log entry ID",
            "example": 1001
          },
          "to_log_id": {
            "type": "integer",
            "format": "int64",
            "description": "Destination user's log entry ID",
            "example": 1002
          },
          "correlation_id": {
            "type": "string",
            "description": "Correlation ID linking both log entries",
            "example": "transfer-uuid"
          },
          "idempotent": {
            "type": "boolean",
            "description": "Whether this was an idempotent retry",
            "example": false
          }
        },
        "required": ["from_user_id", "to_user_id", "amount", "from_balance_before", "from_balance_after", "to_balance_before", "to_balance_after", "from_log_id", "to_log_id", "correlation_id", "idempotent"]
      },
      "AchievementRule": {
        "type": "object",
        "description": "Achievement rule definition for gamification system",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "Unique achievement rule ID",
            "example": 1
          },
          "code": {
            "type": "string",
            "description": "Unique code identifier for the rule (e.g., first_room_join)",
            "example": "first_room_join"
          },
          "name": {
            "type": "string",
            "description": "Human-readable name of the achievement",
            "example": "First Room Join"
          },
          "description": {
            "type": "string",
            "description": "Detailed description of the achievement",
            "example": "Join your first trading room"
          },
          "category": {
            "type": "string",
            "enum": ["performance", "engagement", "seasonal", "admin"],
            "description": "Category of the achievement",
            "example": "engagement"
          },
          "source": {
            "type": "string",
            "description": "Source system that triggers this achievement",
            "example": "room_join"
          },
          "stars_reward": {
            "type": "integer",
            "description": "Number of stars awarded for this achievement",
            "example": 10
          },
          "is_repeatable": {
            "type": "boolean",
            "description": "Whether this achievement can be earned multiple times",
            "example": false
          },
          "max_times": {
            "type": "integer",
            "description": "Maximum times this achievement can be earned (null for unlimited)",
            "example": null
          },
          "scope_type": {
            "type": "string",
            "enum": ["room", "lifetime", "season"],
            "description": "Scope of the achievement",
            "example": "lifetime"
          },
          "is_active": {
            "type": "boolean",
            "description": "Whether this rule is currently active",
            "example": true
          },
          "ui_badge_code": {
            "type": "string",
            "description": "UI badge code for displaying the achievement",
            "example": "badge_first_room"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when the rule was created",
            "example": "2025-11-27T10:00:00Z"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when the rule was last updated",
            "example": "2025-11-27T10:00:00Z"
          }
        },
        "required": ["id", "code", "name", "category", "source", "stars_reward", "is_repeatable", "scope_type", "is_active"]
      },
      "CreateAchievementRuleRequest": {
        "type": "object",
        "description": "Request body for creating a new achievement rule",
        "properties": {
          "code": {
            "type": "string",
            "description": "Unique code identifier for the rule",
            "example": "first_room_join"
          },
          "name": {
            "type": "string",
            "description": "Human-readable name of the achievement",
            "example": "First Room Join"
          },
          "description": {
            "type": "string",
            "description": "Detailed description of the achievement",
            "example": "Join your first trading room"
          },
          "category": {
            "type": "string",
            "enum": ["performance", "engagement", "seasonal", "admin"],
            "description": "Category of the achievement",
            "example": "engagement"
          },
          "source": {
            "type": "string",
            "description": "Source system that triggers this achievement",
            "example": "room_join"
          },
          "stars_reward": {
            "type": "integer",
            "description": "Number of stars awarded for this achievement",
            "example": 10
          },
          "is_repeatable": {
            "type": "boolean",
            "description": "Whether this achievement can be earned multiple times",
            "example": false
          },
          "max_times": {
            "type": "integer",
            "description": "Maximum times this achievement can be earned",
            "example": null
          },
          "scope_type": {
            "type": "string",
            "enum": ["room", "lifetime", "season"],
            "description": "Scope of the achievement",
            "example": "lifetime"
          },
          "ui_badge_code": {
            "type": "string",
            "description": "UI badge code for displaying the achievement",
            "example": "badge_first_room"
          }
        },
        "required": ["code", "name", "category", "source", "stars_reward", "scope_type"]
      },
      "UpdateAchievementRuleRequest": {
        "type": "object",
        "description": "Request body for updating an achievement rule",
        "properties": {
          "name": {
            "type": "string",
            "description": "Human-readable name of the achievement"
          },
          "description": {
            "type": "string",
            "description": "Detailed description of the achievement"
          },
          "stars_reward": {
            "type": "integer",
            "description": "Number of stars awarded for this achievement"
          },
          "is_repeatable": {
            "type": "boolean",
            "description": "Whether this achievement can be earned multiple times"
          },
          "max_times": {
            "type": "integer",
            "description": "Maximum times this achievement can be earned"
          },
          "is_active": {
            "type": "boolean",
            "description": "Whether this rule is currently active"
          },
          "ui_badge_code": {
            "type": "string",
            "description": "UI badge code for displaying the achievement"
          }
        }
      }
    }
  }
}

